apiVersion: 1

datasources:
  # ── 1. Prometheus (Metrics) ──
  - name: Prometheus
    type: prometheus
    access: proxy
    url: http://prometheus:9090
    isDefault: true
    editable: false

  # ── 2. Loki (Logs) ──
  - name: Loki
    type: loki
    access: proxy
    url: http://loki:3100
    editable: false
    jsonData:
      # Extract traceID from Loki log lines to link to X-Ray
      derivedFields:
        - datasourceUid: xray
          matcherRegex: "trace_id=([a-zA-Z0-9]+)"
          name: TraceID
          url: "$${__value.raw}"

  # ── 3. AWS X-Ray (Traces) ──
  - name: X-Ray
    uid: xray
    type: grafana-x-ray-datasource
    access: proxy
    editable: false
    jsonData:
      authType: credentials
      defaultRegion: ap-southeast-2
      # In local mode, X-Ray daemon listens on port 2000
      endpoint: "http://xray-daemon:2000"
    secureJsonData:
      accessKey: "dummy"
      secretKey: "dummy"
